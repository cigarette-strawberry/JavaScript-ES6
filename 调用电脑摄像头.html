<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <!-- <video width="200px" height="150px"></video>
    <canvas width="200px" height="150px"></canvas>
    <p>
        <button @click="start">打开摄像头</button>
        <button @click="snap">截取图像</button>
        <button @click="close">关闭摄像头</button>
    </p> -->
    <video width="200px" height="150px"></video>
    <canvas width="200px" height="150px"></canvas>
    <p>
        <button id="start">打开摄像头</button>
        <button id="snap">截取图像</button>
        <button id="close">关闭摄像头</button>
    </p>
    <script>
        /* self.canvas = document.getElementsByTagName('canvas')[0]
        self.context = self.canvas.getContext('2d')
        self.video = document.getElementsByTagName('video')[0]
        self.MediaStreamTrack

        start() {
            let self = this
            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                navigator.mediaDevices
                    .getUserMedia({
                        video: true,
                        audio: true,
                    })
                    .then(function (stream)
                    {
                        console.log(stream)
                        self.MediaStreamTrack =
                            typeof stream.stop === 'function' ? stream : stream.getTracks()[1]
                        self.video.src = window.URL.createObjectURL(stream)
                        self.video.play()
                    })
                    .catch(function (err)
                    {
                        console.log(err)
                    })
            } else if (navigator.getMedia) {
                navigator
                    .getMedia({
                        video: true,
                    })
                    .then(function (stream)
                    {
                        console.log(stream)
                        self.MediaStreamTrack = stream.getTracks()[1]
                        self.video.src = window.webkitURL.createObjectURL(stream)
                        self.video.play()
                    })
                    .catch(function (err)
                    {
                        console.log(err)
                    })
            }
        },
        snap() {
            let self = this
            self.context.drawImage(self.video, 0, 0, 200, 150)
        },
        close() {
            let self = this
            self.MediaStreamTrack && self.MediaStreamTrack.stop()
        },
 */

        window.onload = function ()
        {
            var canvas = document.getElementsByTagName('canvas')[0],
                context = canvas.getContext('2d'),
                video = document.getElementsByTagName("video")[0],
                snap = document.getElementById("snap"),
                close = document.getElementById("close"),
                start = document.getElementById("start"),
                MediaStreamTrack;
            start.addEventListener('click', function ()
            {
                if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                    navigator.mediaDevices.getUserMedia({
                        video: true,
                        audio: true
                    }).then(function (stream)
                    {
                        console.log(stream);
                        MediaStreamTrack = typeof stream.stop === 'function' ? stream : stream.getTracks()[1];
                        video.src = (window.URL).createObjectURL(stream);
                        video.play();
                    }).catch(function (err)
                    {
                        console.log(err);
                    });
                } else if (navigator.getMedia) {
                    navigator.getMedia({
                        video: true
                    }).then(function (stream)
                    {
                        console.log(stream);
                        MediaStreamTrack = stream.getTracks()[1];
                        video.src = (window.webkitURL).createObjectURL(stream);
                        video.play();
                    }).catch(function (err)
                    {
                        console.log(err);
                    });
                }
            });
            snap.addEventListener('click', function ()
            {
                context.drawImage(video, 0, 0, 200, 150);
            });
            close.addEventListener('click', function ()
            {
                MediaStreamTrack && MediaStreamTrack.stop();
            });
        }
    </script>

</body>

</html>